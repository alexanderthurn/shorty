<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Shorty Dashboard v3</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background: #333; color: white; }
        .row-done { background-color: #e8f5e9; opacity: 0.8; }
        .row-next { background-color: #fff9c4 !important; outline: 2px solid #fbc02d; }
        .badge { padding: 3px 6px; border-radius: 3px; font-size: 0.8em; font-weight: bold; }
        .bg-ok { background: #c8e6c9; color: #2e7d32; }
        .bg-err { background: #ffcdd2; color: #c62828; }
        .btn { cursor: pointer; padding: 8px 15px; border: none; border-radius: 4px; background: #1a73e8; color: white; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        #overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); color:white; justify-content:center; align-items:center; z-index:1000; flex-direction:column; }
    </style>
</head>
<body>

<div id="overlay"><h2 id="status-msg">Upload l√§uft...</h2></div>

<div class="container">
    <h1>üé¨ Bitcoin Jahr 2026 - Manager</h1>
    <div id="table-view">Lade Daten von Google...</div>
</div>

<script>
async function loadList() {
    const view = document.getElementById('table-view');
    try {
        const response = await fetch('list.php');
        const json = await response.json();
        
        let html = `<table><thead><tr><th>Nr</th><th>Titel</th><th>Datum</th><th>Files</th><th>Status</th><th>Aktion</th></tr></thead><tbody>`;
        
        let scrolled = false;

        json.data.forEach(item => {
            const isDone = item.isUploaded;
            const isNext = !isDone && item.hasMp4 && !scrolled;
            if (isNext) scrolled = true;

            html += `<tr class="${isDone ? 'row-done' : (isNext ? 'row-next' : '')}" ${isNext ? 'id="next-video"' : ''}>
                <td><strong>#${item.nr}</strong></td>
                <td>${item.titel}</td>
                <td>${item.datum}</td>
                <td>
                    <span class="badge ${item.hasMp4 ? 'bg-ok' : 'bg-err'}">MP4</span>
                    <span class="badge ${item.hasSrt ? 'bg-ok' : 'bg-err'}">SRT</span>
                </td>
                <td>${isDone ? '‚úÖ Hochgeladen' : '‚è≥ Offen'}</td>
                <td>
                    <button class="btn" onclick="upload(${item.nr})" ${isDone || !item.hasMp4 ? 'disabled' : ''}>
                        ${isDone ? 'Erledigt' : 'Upload'}
                    </button>
                </td>
            </tr>`;
        });

        view.innerHTML = html + '</tbody></table>';

        if (scrolled) {
            document.getElementById('next-video').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

    } catch (e) { view.innerHTML = "Fehler: " + e.message; }
}

async function upload(nr) {
    const overlay = document.getElementById('overlay');
    overlay.style.display = 'flex';
    document.getElementById('status-msg').innerText = `Lade Video #${nr} hoch...`;

    try {
        const fd = new FormData();
        fd.append('video_num', nr);

        const res = await fetch('upload.php', { method: 'POST', body: fd });
        const data = await res.json();

        if (data.success) {
            alert(`Erfolg! Video #${nr} wurde geplant.`);
            loadList();
        } else {
            alert("Fehler: " + data.message);
        }
    } catch (e) { alert("Systemfehler"); }
    overlay.style.display = 'none';
}

loadList();
</script>
</body>
</html>